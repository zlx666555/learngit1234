function pageInit(){sessionStorage.setItem("loginData","zhuiszhu"),carBox=$(".car-box"),carList=carBox.find("li").clone(!1),loginName=sessionStorage.getItem("loginData"),loginName?getCarGoods(loginName):show("您尚未登录,请登录后再试!"),$(".car-box").on("click",".number-btn",function(){var a=$(this).attr("data-type"),t=1*$(this).closest("li").find("input").val();switch(a){case"add":t++;break;case"minus":t--}$(this).closest("li").find("input").val(t),clearTimeout(userAction),updateCountInfo(),userAction=setTimeout(function(){console.log("发送请求"),updatePage()},1e3)})}function updatePage(){var a=carBox.find("li");a.each(function(){var a=$(this).attr("data-goodsID"),t=1*$(this).find("input").val(),o={userID:loginName,goodsID:a,number:t};addShopCar(o)})}function getCarGoods(a){$.ajax({url:"http://datainfo.duapp.com/shopdata/getCar.php",type:"post",data:"userID="+a,dataType:"JSONP",success:function(a){0==a||addPageData(a)}})}function addPageData(a){carBox.empty();for(var t in a){var o=carList.clone(!1),n=a[t].goodsListImg,i=a[t].goodsName,e=1*a[t].price,s=1*a[t].number;o.find("img").attr("src",n),o.find(".goods-name").text(i),o.find(".price").find("i").text(e),o.find("input").val(s),o.attr("data-goodsID",a[t].goodsID),carBox.append(o)}updateCountInfo()}function addShopCar(a){console.log(a),$.ajax({url:"http://datainfo.duapp.com/shopdata/updatecar.php",type:"post",data:a,success:function(a){0==a?console.log("购物车添加失败,请联系管理员"):console.log("添加购物车成功!")}})}function updateCountInfo(){var a=carBox.find("li"),t=0,o=0;a.each(function(){var a=1*$(this).find("input").val(),n=1*$(this).find(".price").find("i").text();t+=a,o+=a*n}),o=o.toFixed(2),$(".car-data-box").find(".number").text(t),$(".car-data-box").find(".count").text(o)}var carBox,carList,loginName=null,userAction;pageInit(),addShopCar({userID:"zhuiszhu",goodsID:"1",number:0});